<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=icon href=/cup_fav.png type=image/gif><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet><link rel=stylesheet href=/css/font.css media=all><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-KRWDYV9R15","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Bayesian A/B Testing"><meta property="og:description" content="In this article, I aim to guide you through the essential process of Bayesian A/B testing using an example along with some practical codes."><meta property="og:type" content="article"><meta property="og:url" content="http://weishanhe.github.io/blogs/bayesian_ab_testing/"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2023-05-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-29T00:00:00+00:00"><meta property="og:site_name" content="Weishan He"><meta name=twitter:card content="summary"><meta name=twitter:title content="Bayesian A/B Testing"><meta name=twitter:description content="In this article, I aim to guide you through the essential process of Bayesian A/B testing using an example along with some practical codes."><link rel=stylesheet href=/bootstrap-5/css/bootstrap.min.css media=all><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#eaedf0;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#18191a;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content="In this article, I aim to guide you through the essential process of Bayesian A/B testing using an example along with some practical codes."><link rel=stylesheet href=/css/single.css><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Bayesian A/B Testing | Weishan He</title></head><body class=light onload=loading()><script src=/bootstrap-5/js/bootstrap.bundle.js></script>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/cup_fav.png width=30 height=30 class="d-inline-block align-top">
Weishan He</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul><div class=text-center><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">Bayesian A/B Testing</h1><div class=text-center>Weishan He
<small>&emsp; &emsp;</small>
May 29, 2023</div></div><article class="page-content p-2"><p>During my time as a Data Scientist at Andela, I had the opportunity to explore the realm of Bayesian A/B testing, <strong>an approach renowned for its robust performance in small sample sizes</strong>. Like many others, my introduction to experimentation was through Frequentist A/B testing. As I familiarized myself with concepts like p-values and statistical power, it took some time for me to streamline the bayesian framework of conducting experiments. In this article, I aim to guide you through the essential process of Bayesian A/B testing using an example along with some practical codes.</p><p>The Bayesian A/B testing, intuitively speaking, revolves around updating our prior beliefs with new information, which is the data we collect through experimentation. Let&rsquo;s consider a scenario where you are working as a Data Scientist for an online travel startup. One day, the product manager approaches you with the idea of testing whether removing a specific page from the sign-up process could potentially increase the sign-up rate. However, since the website caters to business clients like hotels, the traffic volume is relatively low.</p><p>Given these circumstances, you decide to employ Bayesian A/B testing to investigate this hypothesis. The advantage of using Bayesian A/B testing in this scenario is that it doesn&rsquo;t impose strict sample size requirements. Additionally, it allows for the updating of posterior distributions as data accumulates. This flexibility makes Bayesian A/B testing a great choice for your experiment in order to make data-driven decisions for the startup.</p><h2 id=step-1-determine-the-randomized-unit>Step 1: Determine the randomized unit</h2><p>To conduct the experiment, the first step is to determine the randomized unit. Since our goal is to improve the sign-up rate, we focus on new customers as the target for this test.</p><h2 id=step-2-select-the-metrics-of-interest>Step 2: Select the metrics of interest</h2><p>Next, we should define the metrics of interest. <strong>Considering the limited sample size, it is advisable to focus primarily on the metrics at the top of the customer journey funnel.</strong> Therefore, we select sign up rate as our primary metric, which is calculated by dividing the number of individuals who successfully complete the sign-up process by the total number of new website visitors.</p><h2 id=step-3-choose-the-proper-prior-distribution-for-your-metric-of-interest>Step 3: Choose the proper prior distribution for your metric of interest</h2><p><strong>Selecting an appropriate prior distribution poses a significant challenge when conducting Bayesian inference. It is at this juncture that the realms of business and statistics intersect.</strong> As a data scientist, effective communication with stakeholders is crucial in determining the typical distribution of the sign-up rate. Industry benchmarks, research results, practical constraints and more can come in handy for reference. <a href=https://medium.com/the-researchers-guide/finding-the-best-distribution-that-fits-your-data-using-pythons-fitter-library-319a5a0972e9>This medium article</a> also gives some guidance to find the distribution that fits your data using a python package called Fitter.</p><p>In addition to flexibility, Bayesian approach is also known for its rather rigorous computation. Fear not! Let me introduce you to the concept of <strong>conjugate priors</strong>, which significantly ease the burden of updating the prior distributions. When the posterior distribution remains within the same family as the prior distribution, we refer to such priors as conjugate priors.</p><p>In the context of A/B testing, our metrics of interest often fall into two categories: binary (such as click-through rate and sign-up rate) or continuous (such as average revenue and total revenue). I have compiled a table below, presenting the commonly used conjugate priors and their corresponding updating functions for these two data types. If you want to dive deeper into the subject of conjugate priors, I would recommend referring to <a href=https://ocw.mit.edu/courses/18-05-introduction-to-probability-and-statistics-spring-2014/pages/class-slides/>the class materials on this topic from MIT</a>.</p><table><thead><tr><th style=text-align:left>Data Types</th><th style=text-align:left>Conjugate Priors</th><th style=text-align:left>Updating Function</th></tr></thead><tbody><tr><td style=text-align:left>Binary - binomial distribution</td><td style=text-align:left>Beta distribution</td><td style=text-align:left>\(\alpha + \sum_{i=1}^{n}x_i \), \(\beta + \sum_{i=1}^{n}N_i - \sum_{i=1}^{n}x_i\)</td></tr><tr><td style=text-align:left>Continuous - normal distribution (CLT)</td><td style=text-align:left>Normal distribution assuming known variance</td><td style=text-align:left>\( m_2 = \frac{\sigma^2 m_1 + n\sigma_1^{2}m}{n\sigma_1^{2} + \sigma^2} \), \(\sigma_2^2 = \frac{\sigma^2\sigma_1^2}{n\sigma_1^2 + \sigma^2} \), \( m_2\) and \(\sigma_2^2 \) are the posterior mean and variance, \(m_1\) is the prior mean, \(m\) is the sample mean, \(n\) is the sample size</td></tr></tbody></table><h2 id=step-4-apply-monte-carlo-simulation-to-obtain-key-statistics>Step 4: Apply Monte Carlo simulation to obtain key statistics</h2><p>Once we obtain the posterior distribution, we can proceed to calculate essential statistics that help inform recommendations based on the results of Bayesian A/B testing. These statistics include the posterior mean, credible interval, and probability of being the best.</p><p>The first statistic, the posterior mean, represents the average value of the metric of interest derived from the posterior distribution.</p><p>The second is the credible interval. 95% credible interval is the center 95% of the data gained from the posterior distribution. One question that naturally arises is what is the difference between credible intervals in Bayesian approach and confidence intervals in frequentist approach. A frequentist 95% confidence intervals mean that with a large number of repeated samples, the 95% confidence intervals would include the true value of the metric of interest. While 95% credible intervals mean that given the observed data, the metric of interest has 95% probability of falling within this range.</p><p>Interestingly, people usually interpret the frequentist confidence intervals the same way as Bayesian credible intervals, which is wrong. Bayesian credible intervals are constructed based on the understanding that the estimated parameters are random variables with a distribution. Therefore, a credible interval represents an interval in the domain of the posterior distribution where an unobserved parameter value is likely to fall with a particular probability. This differs from the frequentist approach, where the true value is considered fixed and assigning a probability to it is not applicable. By embracing the belief that the estimated parameter is a random variable with a distribution, Bayesian approach provides a more intuitive interpretation of credible intervals.</p><p>Lastly, to determine the probability of being the best, we can employ Monte Carlo simulation by sampling with replacement from the posterior distribution. The probability of being the best can be calculated as follow:
$$ \text{probability of being the best = number of wins / number of trials} $$</p><p>In this context, &ldquo;wins&rdquo; refers to the number of instances where the treatment or variant being evaluated outperforms the alternatives, and &ldquo;trials&rdquo; represents the total number of simulated experiments conducted.</p><p><a href=https://github.com/WeishanHe/causal_inference/blob/main/bayesian_ab_testing_example.ipynb>Here is some sample code</a> to get these statistics.</p><h2 id=step-5-making-conclusions>Step 5: Making Conclusions</h2><p>Probability of being the best is a critical statistic utilized for decision-making, often guiding launch decisions in various companies. Some organizations set a threshold of at least 90% for the winning probability before proceeding with a particular variant. However, it is essential to note that the threshold can be adjusted based on the specific stage of the company. For instance, if a company is in the early stages of building its platform and aims to incorporate new features while taking calculated risks, it may be reasonable to adopt a lower threshold. This approach allows for more experimentation and exploration of potential avenues for growth. On the other hand, a more mature company may prefer to limit the number of features unless they possess the potential to deliver significant impact. In such cases, a higher threshold for the winning probability is preferred, ensuring that only the most promising variants are pursued. <strong>Ultimately, the choice of threshold depends on the company&rsquo;s objectives, risk appetite, and growth stage</strong>, allowing for customized decision-making based on the unique context and priorities of the organization.</p><p>In addition to probability of being the best, we can also answer the following questions empowered by the posterior distribution:</p><ol><li><strong>Will we do any damage by launching? (Type S)</strong>:
By examining the area of posterior distribution below 0, we can assess the likelihood of negative impacts or potential harm associated with launching a particular variant. This valuable insight allows us to mitigate risks and make informed decisions that prioritize user experience and business success.</li><li><strong>Are we off by a magnitude? (Type M)</strong>: The posterior mean enables us to evaluate the magnitude of differences between variants. We can analyze the extent to which a particular variant outperforms or underperforms others, allowing us to gauge the practical significance of the observed effects.</li><li><strong>The probability of falling below a minimal threshold</strong>: We can utilize the posterior distribution to estimate the probability of a metric falling below a predetermined minimum threshold. This analysis helps us identify potential risks associated with performance levels that do not meet the desired standards or requirements.</li></ol><p>Please stay tuned for the next post, where I will dive into a challenging topic of Bayesian A/B testing: determining when to conclude the experiments without strict sample size limitations. Don’t miss out on unlocking the power of decision-making in this flexible field!</p><hr><h2 id=references>References</h2><ol><li><a href=https://medium.com/the-researchers-guide/finding-the-best-distribution-that-fits-your-data-using-pythons-fitter-library-319a5a0972e9>Finding the Best Distribution that Fits Your Data Using Pythons Fitter Library</a></li><li><a href="https://www.youtube.com/watch?v=J6kqvWnUE2Q&amp;t=1s">Talking Bayes to Business: A/B Testing Use Case [Video]</a></li><li><a href=https://towardsdatascience.com/bayesian-a-b-testing-and-its-benefits-a7bbe5cb5103>Bayesian AB Testing and Its Benefits</a></li></ol></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#step-1-determine-the-randomized-unit>Step 1: Determine the randomized unit</a></li><li><a href=#step-2-select-the-metrics-of-interest>Step 2: Select the metrics of interest</a></li><li><a href=#step-3-choose-the-proper-prior-distribution-for-your-metric-of-interest>Step 3: Choose the proper prior distribution for your metric of interest</a></li><li><a href=#step-4-apply-monte-carlo-simulation-to-obtain-key-statistics>Step 4: Apply Monte Carlo simulation to obtain key statistics</a></li><li><a href=#step-5-making-conclusions>Step 5: Making Conclusions</a></li><li><a href=#references>References</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=http://weishanhe.github.io/tags/bayesian-inference target=_blank>Bayesian Inference</a></li><li class=list-inline-item><a href=http://weishanhe.github.io/tags/a/b-testing target=_blank>A/B Testing</a></li><li class=list-inline-item><a href=http://weishanhe.github.io/tags/python target=_blank>Python</a></li></ul></aside><aside class=social><h5>Contact</h5><div class=social-content><ul class=list-inline><li class="list-inline-item text-center"><a target=_blank href=https://www.linkedin.com/in/weishanhe/><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item text-center"><a target=_blank href=https://github.com/WeishanHe><i class="fab fa-github"></i></a></li><li class="list-inline-item text-center"><a target=_blank href=mailto:weishanhe@hotmail.com><i class="fa fa-envelope"></i></a></li></ul></div></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-3" id=recent-posts></div><div class="text-center pt-2"></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center"><div class=pb-2><a href=http://weishanhe.github.io title="Weishan He"><img alt="Footer logo" src=/cup_fav.png height=40px width=40px></a></div>&copy; 2023 All Rights Reserved<div class=text-secondary>Made with
<span class=text-danger>&#10084;</span>
and
<a href=https://github.com/gurusabarish/hugo-profile target=_blank title="Designed and developed by gurusabarish">Hugo Profile</a></div></div></div></div></footer><script>document.body.className.includes("dark")&&(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"))</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))});var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(function(e){return new bootstrap.Tooltip(e)})</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js integrity=sha384-M5jmNxKC9EVnuqeMwRHvFuYUE8Hhp0TgBruj/GZRkYtiMrCRgH7yvv5KY+Owi7TW crossorigin=anonymous></script>
<script type=text/x-mathjax-config>
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['\\(','\\)']],
        displayMath: [['$$','$$'], ['\[','\]']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        TeX: { equationNumbers: { autoNumber: "AMS" },
             extensions: ["AMSmath.js", "AMSsymbols.js"] }
      }
    });
</script></body></html>